<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>list</title><link rel="stylesheet" href="../css/font-awesome-4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="../css/base.css"><link rel="stylesheet" href="../css/list.css"></head><body><div class="w"><div id="topads"></div><div class="site-nav"><div class="wrap clearfix"><ul class="left"><li>欢迎光临易果生鲜！</li><li class="city clearfix"><div class="city-sz">配送至</div><div class="city-tit">广州市 <i class="fa fa-angle-down" aria-hidden="true"></i></div></li><li><img src="../images/main/notice.png" alt=""> <a href="###">温馨提醒</a></li></ul><ul class="right"><li class="apt"><img src="../images/main/招聘1.png" alt=""> <a href="###">人才招聘</a></li><li class="apt"><img src="../images/main/aptitudeicon.png" alt=""> <a href="###">营业资质</a></li><li class="lipin"><a href="###"><i></i> 礼品兑换券入口</a></li><li class="pay"><a href="###"><i></i> 礼品卡绑定</a></li><li class="mobile"><a href="###"><i></i> 手机易果 <s></s></a><div class="con"><div class="item"><img src="../images/main/qrcode_app.jpg" alt=""> <span>扫一扫下载APP</span></div><div class="item"><img src="../images/main/qrcode_wechat.jpg" alt=""> <span>易果生鲜微信</span></div></div></li><li class="myyiguo"><a href="###"><i></i> 我的易果 <s></s></a><div class="con"><a href="###">我的订单</a> <a href="###">我的优惠券</a> <a href="###">我的收藏</a> <a href="###">我的悠币</a> <a href="###">我的退换货</a> <a href="###">预存款查询</a> <a href="###">立即充值</a></div></li><li id="_logout" class="logout"><a href="###">[退出]</a></li><li id="_loginname"><a href="###"></a></li><li id="_register"><a href="###">[注册]</a></li><li id="_login"><a href="###">[登录]</a></li></ul></div></div><div class="header clearfix"><div class="wrap"><div class="logo"><a href="main.html"></a></div><div class="search"><div class="search-bar clearfix"><input type="text" id="keyword" class="search-input" placeholder="输入关键字"> <input type="submit" value="搜索" class="search-btn"></div><div class="search-keywords" id="keywords"><a href="###">奇异果</a> <a href="###" class="hot">蓝莓</a></div></div><div class="shopping-cart"><div class="shopping-btn"><a href="car.html"><span class="totleNum"><b>0</b> </span><b class="totlePrice">购物车</b></a></div><div class="shopping-list"><div class="nogoods">购物车中还没有商品，赶紧选购吧！</div></div></div></div></div><div class="header-nav"><div class="wrap"><div class="catalogs"><div class="catalogs-title"><a href="javascript:;">全部商品分类▼</a></div><div class="catalogs-list"><div class="item"><h3><a href="###"><i></i> 国产水果 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">国产水果</a><div class="sub-list"><a href="###"></a> <a href="###"></a></div><div class="catalogs-ad"><a href="###"><img src="../images/main/navshuiguo.png" alt=""></a></div></h4></div></div><div class="item"><h3><a href="###"><i></i> 精选肉类 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">精选肉类</a></h4><div class="sub-list"><a href="###">牛排</a> <a href="###">羊肉</a> <a href="###">肉制品</a></div><div class="catalogs-ad"><a href="###"><img src="../images/main/navroulei.png" alt=""></a></div></div></div><div class="item"><h3><a href="###"><i></i> 禽类蛋品 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">禽类蛋品</a></h4><div class="sub-list"><a href="###">鸡</a> <a href="###">鸭</a> <a href="###">鹅/鸽/特色禽类</a> <a href="###">蛋</a></div><div class="catalogs-ad"><a href="###"><img src="../images/main/navdanpin.png" alt=""></a></div></div></div><div class="item"><h3><a href="###"><i></i> 海鲜水产 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">海鲜水产</a></h4><div class="sub-list"><a href="###">鳕鱼</a> <a href="###">虾仁</a> <a href="###">大闸蟹券</a> <a href="###">鱼</a> <a href="###">三文鱼</a> <a href="###">蟹</a></div><div class="catalogs-ad"><a href="###"><img src="../images/main/navhaixian.png" alt=""></a></div></div></div><div class="item"><h3><a href="###"><i></i> 乳品糕点 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">乳品糕点</a></h4><div class="sub-list"><a href="###">面包</a> <a href="###"></a></div><div class="catalogs-ad"><a href="###"><img src="../images/main/navrupin.png" alt=""></a></div></div></div><div class="item"><h3><a href="###"><i></i> 方便速食 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">方便速食</a></h4><div class="sub-list"><a href="###">冷冻点心</a> <a href="###">中式主食</a> <a href="###">火锅料</a> <a href="###">半成品菜</a></div><div class="catalogs-ad"><a href="###"><img src="../images/main/navfangbian.png" alt=""></a></div></div></div><div class="item"><h3><a href="###"><i></i> 粮油杂货 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">粮油杂货</a></h4><div class="sub-list"><a href="###">米</a> <a href="###">杂粮</a> <a href="###">面/面制品</a> <a href="###">油</a> <a href="###">调味料</a> <a href="###">干货</a></div><div class="catalogs-ad"><a href="###"><img src="../images/main/navliangyou.png" alt=""></a></div></div></div><div class="item"><h3><a href="###"><i></i> 食品饮料 <s class="fa fa-angle-right" aria-hidden="true"></s></a></h3><div class="sub-item"><h4><a href="###">食品饮料</a></h4><div class="sub-list"><a href="###">水</a> <a href="###">冲调饮品</a> <a href="###">葡萄酒/酒具</a> <a href="###">休闲食品</a></div><div class="catalogs-ad"><a href="###"><img src="" alt=""></a></div></div></div></div></div><div class="nav-items"><ul id="homenav"><li><a href="###">新品专区</a></li><li><a href="###">优质生活</a></li><li><a href="###">银行专区</a></li><li><a href="###">菜谱专栏</a></li></ul></div></div></div><div class="wrap"><div class="page_ad clearfix"></div><div class="select"><div class="all clearfix"><div class="tit">►所有分类</div><ul><li><a href="###">大闸蟹券</a></li></ul></div></div><div id="filter"><a href="javascript:;" class="on">默认排序</a> <a href="javascript:;" class="sales">销量 <i></i> </a><a href="javascript:;" class="price">价格 <i></i> </a><a href="javascript:;" class="discuss">评论 <i></i></a></div></div><div class="goods_list clearfix"><div class="wrap"><ul id="ullist"></ul><div class="loading"><img src="../images/lisst/loding.gif" alt=""></div></div></div><footer class="footer"><div class="wrap"><dl class="col1"><dt>新手指南</dt><dd><p><a href="###">用户注册</a></p><p><a href="###">购物流程</a></p><p><a href="###">订购方式</a></p><p><a href="###">悠币说明</a></p><p><a href="###">会员等级</a></p></dd></dl><dl class="col2"><dt>付款方式</dt><dd><p><a href="###">支付方式</a></p><p><a href="###">礼品卡章程</a></p><p><a href="###">优惠代码</a></p><p><a href="###">卡券购买章程</a></p></dd></dl><dl class="col3"><dt>配送方式</dt><dd><p><a href="###">配送运费</a></p><p><a href="###">时间及范围</a></p></dd></dl><dl class="col4"><dt>售后服务</dt><dd><p><a href="###">退换货政策</a></p><p><a href="###">退换货流程</a></p><p><a href="###">常见问题</a></p><p><a href="###">投诉与建议</a></p></dd></dl><dl class="col5"><dt>关于我们</dt><dd><p><a href="###">公司介绍</a></p><p><a href="###">联系我们</a></p><p><a href="###">业务合作</a></p><p><a href="###">诚信举报</a></p><p><a href="###">用户协议</a></p><p><a href="###">隐私协议</a></p></dd></dl><div class="service"><span>客服热线 400-000-7788 企业采购或团购，请转2号键咨询</span> <span>周一至周日 9:00-21:00</span></div><div class="copyright"><p>所有图片均受著作权保护，未经许可任何单位与个人不得使用、复制、转载、摘编，违者必究法律责任。</p><p>沪ICP备09008015号 Copyright © 2005-2019 版权所有</p><p class="authentication"><a href="###"><img src="../images/main/ordermeal.png" alt=""></a><a href="###"><img src="../images/main/report.png" alt=""></a><a href="###"><img src="../images/main/wxb.png" alt=""></a><a href="###"><img src="../images/reg/153685368061665897_121x29.png" alt=""></a><a href="###"><img src="../images/reg/footer_copy.jpg" alt=""></a><a href="###"><img src="../images/reg/ghs.png" alt=""></a><span>沪公网安备 31010502000002</span></p></div></div></footer><div class="sidebar"><a href="###" id="kefu"></a> <a href="###" id="backtop"></a></div></div></body><script src="../js/common.js"></script><script src="../js/fenlei.js"></script><script src="../js/loginreg.js"></script><script src="../js/Tolist.js"></script><script>(function () {
        let goodslist = document.querySelectorAll('.goods_list');
        let ul = document.querySelector('.goods_list ul');
        let loading = document.querySelector('.goods_list .loading');
        let footer = document.querySelectorAll('.footer');
        let filter = document.querySelector('#filter');
        let page_ad = document.querySelector('.page_ad');
        let ullist = document.querySelector('#ullist');
        console.log(ullist);
        let as = filter.querySelectorAll('a');
        //懒加载
        let ipage = 1;
        let num = 4;
        let paixu = '';
        let types = '';
        var isok = true;
        //跳转到相应列表
        let liebiao = location.search.slice(1);
        console.log(liebiao);


        //初始化数据
        function init() {
            ajax({
                type: 'get',
                url: '../api/list4.php',
                data: {
                    ipage,
                    num,
                    paixu,
                    types,
                    liebiao,
                },
                success: str => {
                    creat(str);
                    if (isok) {
                        bigcreat(str);
                        isok = false;
                        // console.log(isok);

                        ullist.onclick = ev => {
                            for (let i = 0; i < ev.composedPath().length; i++) {
                                if (ev.composedPath()[i].nodeName === 'LI') {
                                    let id = ev.composedPath()[i].dataset
                                    .id; // console.log(id); zuji(id);
                                    window.open('detail.html?' + id);
                                    return;
                                }
                                if (ev.composedPath()[i].className === 'item_buy') {
                                    let arr = JSON.parse(str);
                                    let id = ev.target.parentNode.parentNode.dataset.id;
                                    arr.list.map(item => {
                                        if (item.id == id) {
                                            let goodsname = item.goodsname;
                                            let price = item.price;
                                            let imgurl = item.imgurl;
                                            let size = item.size;
                                            ajax({
                                                type: 'get',
                                                url: '../api/addcart.php',
                                                data: {
                                                    id: id,
                                                    price: price,
                                                    goodsname: goodsname,
                                                    imgurl: imgurl,
                                                    size: size,
                                                },
                                                success: str => {
                                                    alert('加入成功');
                                                }
                                            });
                                        }
                                    })
                                    // console.log(goodsname);

                                    return;
                                }
                            }

                        }
                    }
                }
            });

            function creat(str) {
                // console.log(str);
                let arr = JSON.parse(str);
                let html = arr.list.map(item => {
                    return `<li class="list_item" data-id=${item["id"]}>
                    <div class="item_img">
                        <a href="###"><img src="${item.imgurl}"
                                alt=""></a>
                    </div>
                    <div class="item_info">
                        <div class="goodsname">
                            <a href="###">${item.goodsname}</a>
                        </div>
                        <div class="goodsprice">
                            <span class="price">
                                <strong>¥${item.price}</strong>
                            </span>
                        </div>
                    </div>
                    <div class="item_buy">
                        <a href="###">加入购物车</a>
                    </div>
                </li>`
                }).join('');
                ul.innerHTML += html;



                //懒加载
                // let sum = Math.ceil(arr.total / num); //总页数
                // let timer = null;
                // let keshiqu = document.documentElement.clientHeight;
                // let bheight = document.body.offsetHeight;
                // let zeronum = bheight - keshiqu;
                // if (sum > 1 && ipage != sum) {
                //     document.onscroll = () => {
                //         if (parseInt(document.documentElement.scrollTop + 78) <= zeronum + 10 &&
                //         parseInt(document.documentElement.scrollTop + 78) >= zeronum - 10) {
                //             loading.style.display = 'block';
                //             ipage++;
                //             init();
                //             zeronum += 372;
                //         }
                //     }
                // } else {
                //     loading.style.display = 'none';
                //    document.onscroll = null;
                // }

            }

            function bigcreat(str) {
                let arr1 = JSON.parse(str);
                let bigpic = arr1.list[0].bigurl.split("&");
                page_ad.innerHTML = `<a href="###" class="big">
                 <img src="${bigpic[0]}" alt="">
             </a>
             <a href="###" class="medium mr">
                 <img src="${bigpic[1]}" alt="">
             </a>
             <a href="###" class="medium mr">
                 <img src="${bigpic[2]}" alt="">
             </a>
             <a href="###" class="small mr">
                 <img src="${bigpic[3]}" alt="">
             </a>
             <a href="###" class="small">
                 <img src="${bigpic[4]}" alt="">
             </a>`;
            }




            //足迹
            function zuji(id) {
                let goodlist = localStorage.goodlist;
                console.log(goodlist);
                if (goodlist) {
                    //证明有足迹
                    // console.log(goodlist);
                    let arr = goodlist.split('&');
                    // console.log(arr);
                    let index = arr.indexOf(id); //-1没有，直接把id拼接在后面；非-1,有，去掉旧的id，再把新的id放到末尾
                    // console.log(index);
                    let str = '';
                    if (index >= 0) {
                        arr.splice(index, 1);
                        arr.push(id);
                        str = arr.join('&');
                    } else {
                        str = goodlist + '&' + id;
                    }
                    // let str = goodlist + '&' + id;
                    localStorage.goodlist = str;
                } else {
                    //没有足迹
                    localStorage.goodlist = id;
                }
            }


        }
        init();

        //各类排序
        for (let i = 1; i < as.length; i++) {
            as[i].onclick = () => {
                types = as[i].innerText;
                console.log(types);
                let liebiao = location.search.slice(1);
                paixu = 'desc';
                ul.innerHTML = '';
                init();
            }
        }



    })();</script></html>